<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/main.css" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.97em%22 font-size=%2280%22>ðŸ“Ÿ</text></svg>"
    />

    <script src="wasm_exec.js"></script>

    <script>
      async function createRunningEmulator() {
        removeFrame();
        emuFrame = createEmuFrame();
        const pgmName = document.querySelector("#program").value;
        emuFrame.setAttribute("data-pgm-name", "roms/" + pgmName);
        emuFrame.setAttribute(
          "data-speed",
          document.querySelector("#speed").value
        );
        document.querySelector("#wrapper").appendChild(emuFrame);
      }

      async function createStoppedEmulator() {
        removeFrame();
        document.querySelector("#wrapper").appendChild(createEmuFrame());
      }

      function removeFrame() {
        oldFrame = document.querySelector("#emulator");
        if (oldFrame) {
          document.querySelector("#wrapper").removeChild(oldFrame);
        }
      }

      function createEmuFrame() {
        var emuFrame = document.createElement("iframe");
        emuFrame.src = "emulator.html";
        emuFrame.id = "emulator";
        emuFrame.width = 1000;
        emuFrame.height = 500;
        return emuFrame;
      }
    </script>
    <title>CHIP-8 ~ Go & WASM</title>
  </head>
  <body onload="createStoppedEmulator();">
    <select id="program">
      <option>ASTRODODGE</option>
      <option>BRIX</option>
      <option>GLITCHGHOST</option>
      <option>INVADERS</option>
      <option>MERLIN</option>
      <option>OUTLAW</option>
      <option>RPS</option>
      <option>SLIPPERYSLOPE</option>
      <option>SNAKE</option>
      <option>SPACEJAM</option>
      <option>TANK</option>
      <option>TETRIS</option>
      <option>TICTAC</option>
    </select>

    <button onclick="createRunningEmulator()">LOAD PROGRAM</button>

    <button onclick="createStoppedEmulator()">REBOOT SYSTEM</button>

    SPEED:
    <select id="speed">
      <option>10</option>
      <option>20</option>
      <option selected>30</option>
      <option>40</option>
      <option>50</option>
      <option>60</option>
      <option>70</option>
      <option>80</option>
      <option>90</option>
      <option>100</option>
    </select>

    <footer>
      CHIP-8 Emulator in Go, Ben Coleman<br />
      <a href="https://github.com/benc-uk/chip8"> GitHub Project </a>
    </footer>

    <hr />

    <!-- the iframe with the emulator will go here -->
    <div id="wrapper"></div>

    Controls:<br />
    Note. Each game uses different keypad inputs, you will have to experiment,
    but WASD is common for movement<br /><br />
    <img src="img/keys.png" width="400px" style="padding-left: 3rem" />
  </body>
</html>
